---
title: Основы языка SQL
---

# Типы данных и операторы СУБД PostgreSQL

## Общая характеристика языка SQL

Язык структурированных запросов (SQL — Structured Query Language) является международным стандартом взаимодействия с реляционными базами данных, утвержденным Международной организацией по стандартизации (ISO) в 1987 году.

::: info ПРИНЦИП ДЕЙСТВИЯ
Фундаментальной особенностью SQL является его **декларативный характер**. Язык определяет спецификацию требуемого результата (какая информация должна быть получена), абстрагируясь от алгоритма выполнения операции (способа получения данных).
:::

## Классификация операторов языка

Командный состав языка SQL подразделяется на функциональные группы (подмножества), предназначенные для выполнения различных категорий задач администрирования и обработки данных. Основные операторы представлены в таблице 1.

**Таблица 1 — Основные операторы языка SQL**

| Подмножество                                                        |  Оператор  | Назначение                                                               |
| :------------------------------------------------------------------ | :--------: | :----------------------------------------------------------------------- |
| **DDL (Data Definition Language)**<br>_Определение данных_          |  `CREATE`  | Создание новых объектов в базе данных (таблиц, индексов, представлений). |
|                                                                     |   `DROP`   | Удаление существующих объектов из базы данных.                           |
|                                                                     |  `ALTER`   | Модификация структуры существующих объектов.                             |
| **DML (Data Manipulation Language)**<br>_Манипулирование данными_   |  `INSERT`  | Вставка новых записей (строк) в таблицу.                                 |
|                                                                     |  `DELETE`  | Удаление записей из таблицы.                                             |
|                                                                     |  `UPDATE`  | Обновление значений в существующих записях.                              |
|                                                                     |  `SELECT`  | Выборка (извлечение) данных в соответствии с заданными критериями.       |
| **DCL (Data Control Language)**<br>_Управление доступом_            |  `GRANT`   | Предоставление прав (привилегий) доступа к объектам.                     |
|                                                                     |  `REVOKE`  | Отзыв ранее выданных прав доступа.                                       |
| **TCL (Transaction Control Language)**<br>_Управление транзакциями_ |  `COMMIT`  | Фиксация изменений текущей транзакции.                                   |
|                                                                     | `ROLLBACK` | Откат изменений текущей транзакции до точки сохранения.                  |

## Синтаксические правила и формат записи {#syntax-rules}

Язык SQL характеризуется свободным форматом записи, что обеспечивает гибкость при формировании программного кода.

### Основные правила оформления запросов {#formatting-rules}

1.  **Регистронезависимость.** Команды и ключевые слова могут быть записаны как в верхнем, так и в нижнем регистре.
    - _Примечание:_ Для ключевых слов (операторов) принято использовать верхний регистр (`SELECT`, `FROM`), а для идентификаторов объектов — нижний.
2.  **Структура команды.** SQL-инструкция состоит из предложений (clauses), начинающихся с соответствующего ключевого слова.
3.  **Завершение инструкции.** Стандартным разделителем команд является символ «точка с запятой» (`;`).
4.  **Разделители.** Ключевые слова, идентификаторы и литералы разделяются пробельными символами (пробел, табуляция, перевод строки). Допускается отсутствие разделителей в случаях, исключающих неоднозначную интерпретацию синтаксиса.

Пример корректной структуры запроса:

```sql
SELECT * FROM personnel
WHERE rank_id = 5;
```

## Структурные элементы SQL-инструкций

Команда SQL представляет собой совокупность лексических единиц. Структура типовой инструкции включает ключевые слова, идентификаторы и константы.

Ниже приведен пример разбора компонентов команды на уровне программного кода (вместо графической схемы):

```sql
SELECT "LastName", "FirstName", post_id -- Ключевые слова, Идентификаторы
FROM public.personnel -- Идентификаторы схемы и таблицы
WHERE status_code = 'ACTIVE' -- Идентификатор и Строковая константа
AND salary > 50000.00; -- Числовая константа
```

### Ключевые слова (Keywords)

Ключевые слова — это лексемы, имеющие зарезервированное значение для синтаксического анализатора SQL. Их применение строго регламентировано стандартом языка.

**Примеры:** `SELECT`, `DELETE`, `CREATE`, `WHERE`.

### Идентификаторы (Identifiers)

Идентификаторы используются для именования объектов базы данных: таблиц, столбцов, индексов, представлений, ограничений и функций.

**Правила формирования и уникальности:**

- Идентификаторы должны быть уникальны в пределах своей области видимости (namespace).
- В пределах одной схемы имена таблиц, индексов, последовательностей и представлений не должны совпадать (так как они относятся к одному классу объектов — отношениям).
- Имена таблиц и функций могут совпадать, так как это объекты различных типов.

**Синтаксические требования:**

- Первый символ должен быть буквой (a-z) или знаком подчеркивания (`_`).
- Последующие символы могут включать буквы, цифры, знаки подчеркивания (`_`) или знака доллара (`$`).
- Стандартная максимальная длина идентификатора в PostgreSQL составляет **63 байта**.

::: warning ЧУВСТВИТЕЛЬНОСТЬ К РЕГИСТРУ
В СУБД PostgreSQL реализована следующая логика обработки регистра:

1.  **Идентификаторы без кавычек:** Автоматически приводятся к нижнему регистру (lowercase).
    - `MyTable` интерпретируется системой как `mytable`.
2.  **Идентификаторы в двойных кавычках:** Сохраняют регистр символов. `"MyTable"` интерпретируется именно как `MyTable`.

:::

### Константы (Literals)

Константы представляют собой фиксированные значения данных. В PostgreSQL выделяют три основные группы констант.

#### Строковые константы

Представляют собой последовательность символов, заключенную в одинарные апострофы (`'`).

- **Пример:** `'Это строка'`.
- **Экранирование:** Для включения апострофа в тело строки он дублируется: `'Жанна д''Арк'`.
- **Конкатенация:** Две строковые константы, разделенные символом перевода строки, автоматически объединяются.

**Dollar-quoted String Constants (Специфика PostgreSQL):**
Для записи сложных строк (например, тел функций или текста с множеством кавычек) используется синтаксис со знаком доллара `$$` или именованными тегами `$tag$`.

```sql
-- Стандартная запись
'Жанна д''Арк'

-- Запись через dollar-quoting (экранирование не требуется)
$$Жанна д'Арк$$
$HistoryTag$Жанна д'Арк$HistoryTag$
```

#### Битовые константы

Используются для представления последовательностей бит.

- **Двоичный формат:** Префикс `B`, допустимые символы `0` и `1`.
  - Пример: `B'1001'`
- **Шестнадцатеричный формат:** Префикс `X`, допустимые символы `0-F`.
  - Пример: `X'1FF'`

#### Числовые константы

Допускают запись целых и вещественных чисел. В записи не допускается использование пробелов.

**Форматы записи:**

| Формат                      | Описание                  | Пример                             |
| :-------------------------- | :------------------------ | :--------------------------------- |
| **Целое число**             | Только цифры              | `42`                               |
| **Десятичная дробь**        | Обязательно наличие точки | `3.5`, `4.`, `.01`                 |
| **Экспоненциальная запись** | Использование символа `e` | `5e2` ($5 \times 10^2$), `1.25e-3` |

### Операторы (Operators)

Операторы представляют собой зарезервированные символы или комбинации символов, инициирующие выполнение определенных действий над операндами (выражениями).

В качестве операндов могут выступать:

- Константы (литералы).
- Значения столбцов.
- Переменные и параметры функций.
- Результаты выполнения подзапросов.

### Комментирование кода

Комментарии — это фрагменты текста, игнорируемые интерпретатором SQL при синтаксическом анализе. Они служат для документирования логики запросов.

В PostgreSQL поддерживаются два типа комментариев:

1.  **Однострочный комментарий:** Начинается с двойного тире `--`. Игнорируется весь текст до конца текущей строки.
2.  **Многострочный (блочный) комментарий:** Заключается в конструкцию `/* ... */`. Позволяет комментировать несколько строк кода или фрагмент внутри строки.

```sql
SELECT _ FROM personnel -- Выборка всех сотрудников
WHERE department_id = 10
AND status = 'active';
```

## Обзор типов данных PostgreSQL

СУБД PostgreSQL обладает развитой системой типов данных, включающей как встроенные стандартизированные типы, так и механизмы создания пользовательских типов.

### Числовые типы (Numeric Types)

Предназначены для хранения целочисленных и вещественных значений. Основные характеристики приведены в таблице 2.

**Таблица 2 — Числовые типы данных**

| Наименование                      | Размер     | Описание                                                                                                                                 |
| :-------------------------------- | :--------- | :--------------------------------------------------------------------------------------------------------------------------------------- |
| `smallint`                        | 2 байта    | Целое число малого диапазона (от -32 768 до +32 767).                                                                                    |
| `integer`                         | 4 байта    | Стандартное целое число (наиболее используемый тип).                                                                                     |
| `bigint`                          | 8 байт     | Целое число большого диапазона.                                                                                                          |
| `decimal(p, s)` / `numeric(p, s)` | Переменный | Число произвольной точности. <br> **p** (precision) — общее количество значащих цифр.<br> **s** (scale) — количество цифр после запятой. |
| `real`                            | 4 байта    | Вещественное число с плавающей точкой (точность ~6 десятичных знаков).                                                                   |
| `double precision`                | 8 байт     | Вещественное число с плавающей точкой двойной точности (~15 знаков).                                                                     |
| `smallserial`                     | 2 байта    | Псевдотип для создания автоинкрементируемых полей (smallint).                                                                            |
| `serial`                          | 4 байта    | Псевдотип для автоинкремента (integer).                                                                                                  |
| `bigserial`                       | 8 байт     | Псевдотип для автоинкремента (bigint).                                                                                                   |

::: info ОСОБЕННОСТИ ХРАНЕНИЯ
Типы `smallserial`, `serial` и `bigserial` не являются самостоятельными типами данных. При их объявлении система автоматически создает последовательность (sequence) и устанавливает для столбца значение по умолчанию, извлекаемое из этой последовательности.
:::

### Символьные типы (Character Types)

Используются для хранения текстовой информации.

**Таблица 3 — Символьные типы данных**

| Наименование                          | Описание                                    | Особенности                                                                  |
| :------------------------------------ | :------------------------------------------ | :--------------------------------------------------------------------------- |
| `character(n)` / `char(n)`            | Строка фиксированной длины `n`.             | Если длина введенной строки меньше `n`, она дополняется пробелами справа.    |
| `character varying(n)` / `varchar(n)` | Строка переменной длины с ограничением `n`. | Хранит только введенные символы. Если строка превышает `n`, выдается ошибка. |
| `text`                                | Строка неограниченной длины.                | Оптимальный выбор для хранения больших объемов текста в PostgreSQL.          |

### Типы даты и времени (Date/Time Types)

Обеспечивают хранение календарных дат и времени суток.

**Таблица 4 — Типы даты/времени**

| Наименование      | Размер  | Описание                                           |
| :---------------- | :------ | :------------------------------------------------- |
| `timestamp [(p)]` | 8 байт  | Дата и время (без указания часового пояса).        |
| `timestamptz`     | 8 байт  | Дата и время с часовым поясом (рекомендуемый тип). |
| `date`            | 4 байта | Только дата (год, месяц, день).                    |
| `time [(p)]`      | 8 байт  | Только время суток.                                |

Параметр точности `p` (0–6) определяет количество знаков в дробной части секунд (до микросекунд).

**Форматы ввода:**
Значения заключаются в одинарные апострофы.

- Дата: `'2021-05-25'`, `'25.05.2021'`.
- Время: `'10:45:00'`, `'10:45'`.
- Timestamp: `'2021-05-25 10:45:00'`.

### Логический и бинарный типы

1.  **Boolean (`boolean`):** Принимает состояния истинности.
    - _True:_ `TRUE`, `'t'`, `'true'`, `'y'`, `'yes'`, `'1'`.
    - _False:_ `FALSE`, `'f'`, `'false'`, `'n'`, `'no'`, `'0'`.
    - _Null:_ Неизвестное значение.
    - Вывод осуществляется символами `t` или `f`.

2.  **Bytea (`bytea`):** Предназначен для хранения двоичных данных (изображений, скомпилированных файлов). Формат ввода — шестнадцатеричная строка (например, `\xDEADBEEF`).

### Специализированные типы данных

Современные версии PostgreSQL поддерживают работу со слабоструктурированными данными и коллекциями.

#### JSON

Используются для хранения данных в формате JSON (JavaScript Object Notation).

- **`json`**: Хранит точную текстовую копию входных данных (включая пробелы и порядок ключей). Требует парсинга при каждом обращении.
- **`jsonb`** (Binary JSON): Хранит данные в декомпозированном двоичном формате.
  - _Преимущества:_ Поддерживает индексацию (GIN-индексы), обеспечивает высокую скорость обработки.
  - _Особенность:_ Не сохраняет пробелы и порядок ключей, удаляет дубликаты ключей.

::: tip РЕКОМЕНДАЦИЯ
Для большинства задач, требующих обработки и поиска по JSON-структурам, рекомендуется использовать тип `jsonb`.
:::

#### Массивы (Arrays)

PostgreSQL позволяет определить столбец таблицы как многомерный массив переменной длины любого встроенного или пользовательского типа.

**Синтаксис объявления:**

```sql
CREATE TABLE report (
id integer,
temperatures integer[], -- Одномерный массив целых чисел
schedule text[][] -- Двумерный массив текста
);
```

**Пример ввода данных:**

```sql
INSERT INTO report VALUES (1, '{20, 22, 25}', '{{"Пн", "Вт"}, {"Ср", "Чт"}}');
```

## Система операторов SQL

В СУБД PostgreSQL реализован широкий набор операторов для выполнения арифметических, логических и строковых операций.

### Математические операторы

Используются для выполнения вычислений над числовыми типами данных.

| Оператор | Описание действия           | Пример  |
| :------: | :-------------------------- | :------ |
|   `+`    | Сложение                    | `a + b` |
|   `-`    | Вычитание                   | `a - b` |
|   `*`    | Умножение                   | `a * b` |
|   `/`    | Деление                     | `a / b` |
|   `%`    | Остаток от деления (модуль) | `a % b` |
|   `^`    | Возведение в степень        | `a ^ b` |

::: warning ОСОБЕННОСТЬ ЦЕЛОЧИСЛЕННОГО ДЕЛЕНИЯ
При делении операндов целочисленного типа (integer, bigint) дробная часть результата **отбрасывается** (усекается), округление не производится.
_Пример:_ Результатом выражения `5 / 2` будет `2`, а не `2.5`. Для получения точного результата необходимо привести хотя бы один операнд к вещественному типу: `5.0 / 2`.
:::

### Операторы сравнения и предикаты {#comparison-operators}

Применяются к стандартным типам данных (числовые, строковые, дата/время) и возвращают логическое значение (`TRUE`, `FALSE` или `NULL`).

**Базовые операторы:**

- `<` (меньше), `>` (больше)
- `<=` (меньше или равно), `>=` (больше или равно)
- `=` (равно)
- `<>` или `!=` (не равно)

**Специальные предикаты сравнения:**

1.  **Диапазон значений (`BETWEEN`):**
    Проверяет вхождение значения в интервал, включая границы.

    ```sql
    -- Эквивалентные конструкции
    value BETWEEN x AND y
    value >= x AND value <= y
    ```

2.  **Членство во множестве (`IN`):**
    Проверяет совпадение значения с любым элементом из списка.

    ```sql
    department_id IN (101, 102, 105)
    ```

3.  **Проверка на неопределенность (`IS NULL`):**
    Единственный корректный способ проверки на равенство значению `NULL`.

    ::: warning ВНИМАНИЕ
    Использование операторов `=` или `!=` с `NULL` (например, `col = NULL`) всегда возвращает `NULL` (неизвестность), а не `TRUE` или `FALSE`. Корректная запись: `col IS NULL` или `col IS NOT NULL`.
    :::

### Строковые операторы и поиск по шаблону {#string-pattern-ops}

**Конкатенация строк (`||`):**
Оператор объединяет две строки в одну.
_Пример:_ `'Иванов' || ' ' || 'И.И.'` $\rightarrow$ `'Иванов И.И.'`

**Поиск по шаблону (`LIKE`):**
Используется для сравнения строки с шаблоном, содержащим метасимволы (wildcards).

Синтаксис: `[NOT] LIKE шаблон [ESCAPE спецсимвол]`

|     Метасимвол      | Описание                                                     |
| :-----------------: | :----------------------------------------------------------- |
| `_` (подчеркивание) | Заменяет любой **одиночный** символ.                         |
|    `%` (процент)    | Заменяет любую последовательность символов (включая пустую). |

**Экранирование (Escape):**
Для поиска символов `%` или `_` как части текста используется спецсимвол (по умолчанию обратная косая черта `\`).

```sql
-- Найти строки, начинающиеся с "Data"
name LIKE 'Data%'

-- Найти строки, содержащие "100%" (экранирование процента)
description LIKE '%100\%' ESCAPE '\'
```

### Логические операторы {#logical-operators}

Используются для комбинирования условий отбора.

- **`AND` (Конъюнкция):** Истина, если оба условия истинны.
- **`OR` (Дизъюнкция):** Истина, если хотя бы одно условие истинно.
- **`NOT` (Отрицание):** Инвертирует значение логического выражения.

### Преобразование типов данных (Type Casting) {#type-casting}

Поскольку PostgreSQL является языком со строгой типизацией, часто возникает необходимость явного приведения значения одного типа к другому (например, строки, содержащей цифры, к числовому формату).

Существует два синтаксических способа преобразования:

1.  **Стандарт SQL:** Использование функции `CAST`.
    ```sql
    CAST('100' AS integer)
    ```
2.  **Синтаксис PostgreSQL:** Использование оператора `::`.
    ```sql
    '100'::integer
    '2025-01-01'::date
    ```

::: danger ОШИБКА ПРЕОБРАЗОВАНИЯ
Если содержимое преобразуемого значения не соответствует целевому типу (например, попытка преобразовать строку `'text'` в `integer`), СУБД вернет ошибку выполнения транзакции.
:::

### Приоритет операторов {#operator-precedence}

Порядок вычисления выражений определяется приоритетом операторов. Операторы с равным приоритетом выполняются слева направо. Для явного изменения порядка действий используются скобки `()`.

**Таблица 5 — Приоритет операторов (по убыванию)**

|  Приоритет   | Операторы                                        |
| :----------: | :----------------------------------------------- |
| **Высокий**  | `::` (приведение типа)                           |
| $\downarrow$ | `[]` (выбор элемента массива)                    |
|              | `^` (степень)                                    |
|              | `*`, `/`, `%`                                    |
|              | `+`, `-`                                         |
|              | `BETWEEN`, `IN`, `LIKE`, `SIMILAR`               |
|              | `<`, `>`, `=`, `<=`, `>=`, `<>`, `!=`, `IS NULL` |
|              | `NOT`                                            |
|              | `AND`                                            |
|  **Низкий**  | `OR`                                             |

## Выводы по первому учебному вопросу {#conclusion-q1}

В ходе рассмотрения учебного вопроса установлено, что эффективность функционирования информационных систем на базе СУБД PostgreSQL напрямую зависит от корректного выбора типов данных на этапе проектирования. Строгая типизация и использование специализированных форматов хранения (JSONB, массивы) позволяют оптимизировать использование дискового пространства, обеспечить целостность информации и повысить производительность обработки запросов.

Владение синтаксическими конструкциями и номенклатурой операторов языка SQL является фундаментальным требованием для оператора базы данных. Знание правил приоритета операций, механизмов приведения типов и специфики обработки неопределенных значений (`NULL`) обеспечивает формирование корректных инструкций и исключает возникновение логических коллизий при реализации алгоритмов манипулирования данными.
